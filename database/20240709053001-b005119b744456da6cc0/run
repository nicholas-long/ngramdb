#!/bin/bash

# overwrite main readme file
# for now while this is not running in a container, this will work
READMEFILE="$(pwd)/README.md"
echo "writing readme file $READMEFILE" >/dev/stderr
cd $(dirname $0)

function generate_readme {
  cat header.md 
  echo
  echo '```bash'
  ngram --help 
  echo '```'
  echo
  for subcommand in $(grep -R '.--help' ../20240704164832-ae846f0d186e581bb7aa/subcommands | cut -d : -f 1 | awk -F / '{print $NF}' | sort -u | grep -v 'find-executable'); do
    # ignore find-executable because it does not work with --help
    echo "## subcommand: $subcommand"
    echo '```bash'
    echo ngram "$subcommand" --help
    ngram "$subcommand" --help 2>&1
    echo '```'
  done
  echo
  echo '# Test Run Output'
  echo
  echo '```'
  cat ../20240705000124-9769d8256b20e049b259/stdout.log
  echo '```'
  echo
  cat footer.md
  cat ../../LICENSE
}

generate_readme | ngram replace "$READMEFILE"

wc -l "$READMEFILE"
